import{_ as B,b as I,c as D,a as m}from"./ButtonBase-18bcf650.js";import{r as o,j as x,a as P}from"./index-3b93fbf4.js";import{o as E,d as U}from"./useId-58975782.js";const V=["onChange","maxRows","minRows","style","value"];function d(s){return parseInt(s,10)||0}const Z={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function C(s){return s==null||Object.keys(s).length===0||s.outerHeightStyle===0&&!s.overflow}const $=o.forwardRef(function(a,W){const{onChange:y,maxRows:h,minRows:c=1,style:v,value:f}=a,T=B(a,V),{current:M}=o.useRef(f!=null),l=o.useRef(null),O=I(W,l),b=o.useRef(null),u=o.useRef(0),[p,S]=o.useState({outerHeightStyle:0}),g=o.useCallback(()=>{const e=l.current,t=E(e).getComputedStyle(e);if(t.width==="0px")return{outerHeightStyle:0};const n=b.current;n.style.width=t.width,n.value=e.value||a.placeholder||"x",n.value.slice(-1)===`
`&&(n.value+=" ");const _=t.boxSizing,j=d(t.paddingBottom)+d(t.paddingTop),A=d(t.borderBottomWidth)+d(t.borderTopWidth),z=n.scrollHeight;n.value="x";const w=n.scrollHeight;let i=z;c&&(i=Math.max(Number(c)*w,i)),h&&(i=Math.min(Number(h)*w,i)),i=Math.max(i,w);const F=i+(_==="border-box"?j+A:0),L=Math.abs(i-z)<=1;return{outerHeightStyle:F,overflow:L}},[h,c,a.placeholder]),R=(e,r)=>{const{outerHeightStyle:t,overflow:n}=r;return u.current<20&&(t>0&&Math.abs((e.outerHeightStyle||0)-t)>1||e.overflow!==n)?(u.current+=1,{overflow:n,outerHeightStyle:t}):e},H=o.useCallback(()=>{const e=g();C(e)||S(r=>R(r,e))},[g]),k=()=>{const e=g();C(e)||P.flushSync(()=>{S(r=>R(r,e))})};o.useEffect(()=>{const e=U(()=>{u.current=0,l.current&&k()});let r;const t=l.current,n=E(t);return n.addEventListener("resize",e),typeof ResizeObserver<"u"&&(r=new ResizeObserver(e),r.observe(t)),()=>{e.clear(),n.removeEventListener("resize",e),r&&r.disconnect()}}),D(()=>{H()}),o.useEffect(()=>{u.current=0},[f]);const N=e=>{u.current=0,M||H(),y&&y(e)};return x.jsxs(o.Fragment,{children:[x.jsx("textarea",m({value:f,onChange:N,ref:O,rows:c,style:m({height:p.outerHeightStyle,overflow:p.overflow?"hidden":void 0},v)},T)),x.jsx("textarea",{"aria-hidden":!0,className:a.className,readOnly:!0,ref:b,tabIndex:-1,style:m({},Z.shadow,v,{padding:0})})]})}),K=$;export{K as T};
